# 🔍 Phase 1.1.1 타입 정의 현황 분석 결과

**분석 일시**: 2025-01-20  
**분석 대상**: TypeScript/TSX 파일 전체  
**브랜치**: refactor/v1  

---

## 📊 타입 정의 현황 요약

### ✅ 식별된 주요 중복 타입들

#### 1. **FileNode 인터페이스** (🔴 중복도: 매우 높음)
| 파일 위치 | 사용 목적 | 속성 |
|-----------|-----------|------|
| `types/wiki.ts` | 글로벌 타입 정의 | name, path, type, children? |
| `app/wiki/page.tsx` | 메인 페이지 컴포넌트 | name, type, path, children? |
| `components/TreeComponent.tsx` | 트리 컴포넌트 | name, type, path, children? |

**분석**: 동일한 구조의 FileNode가 3곳에 중복 정의됨. 완전히 통합 가능.

#### 2. **NotificationData 인터페이스** (🟡 중복도: 중간)
| 파일 위치 | 사용 목적 | 속성 |
|-----------|-----------|------|
| `hooks/useNotification.ts` | 훅 내부 타입 | id, type, title, message?, duration? |
| `contexts/NotificationContext.tsx` | 컨텍스트 타입 | id, type, title, message?, duration? |

**분석**: 동일한 구조로 중복됨. 통합 필요.

#### 3. **API 관련 타입들** (🟢 부분 중복)
| 파일 위치 | 타입명 | 사용 목적 |
|-----------|--------|-----------|
| `utils/apiClient.ts` | ApiResponse<T> | 표준 API 응답 |
| `utils/apiClient.ts` | FileApiRequest | 파일 API 요청 |
| `utils/apiClient.ts` | FileAction | 파일 작업 타입 |
| `app/api/files/route.ts` | FileEntry, DirectoryEntry | API 내부 타입 |
| `app/api/watch/route.ts` | FileEvent | 파일 감시 이벤트 |

**분석**: 일부는 이미 잘 정의됨. API 내부 타입들과 통합 검토 필요.

---

## 🎯 중앙화 대상 타입 분류

### **카테고리 1: 파일 시스템 타입** (`fileSystem.ts`)
```typescript
// 통합 예정 타입들
- FileNode (3곳에서 중복)
- FileEntry, DirectoryEntry (API 전용)
- FileType (확장자 타입)
- FileEvent (파일 감시)
```

### **카테고리 2: API 관련 타입** (`api.ts`)
```typescript
// 기존 타입 활용
- ApiResponse<T> ✅ 이미 잘 정의됨
- ApiRequestOptions ✅ 이미 잘 정의됨
- FileApiRequest ✅ 이미 잘 정의됨
- FileAction ✅ 이미 잘 정의됨
```

### **카테고리 3: UI 컴포넌트 타입** (`ui.ts`)
```typescript
// 컴포넌트별 고유 타입들
- ContextMenuState
- CreateDialogState
- NotificationData (중복 해결 필요)
- TreeComponentProps
- CreateFileModalProps
- CreateFileParams
```

### **카테고리 4: 공통 기본 타입** (`common.ts`)
```typescript
// 범용 타입들
- 에러 처리: ErrorContext (이미 errorUtils에 정의됨)
- 로깅: LogLevel (이미 errorUtils에 정의됨)
- 메시지: MessageConfig, MessageState
```

---

## 🔗 의존성 관계 매핑

### **FileNode 의존성 체인**
```
types/wiki.ts (글로벌)
  ├── app/wiki/page.tsx (메인 페이지)
  ├── components/TreeComponent.tsx (트리 렌더링)
  └── components/CreateFileModal.tsx (파일 생성)
```

### **NotificationData 의존성 체인**
```
contexts/NotificationContext.tsx (글로벌 상태)
  ├── hooks/useNotification.ts (로컬 상태)
  ├── components/Notification.tsx (개별 알림)
  └── components/NotificationContainer.tsx (컨테이너)
```

### **API 타입 의존성 체인**
```
utils/apiClient.ts (중앙 정의)
  ├── app/api/file/route.ts (파일 API)
  ├── app/api/files/route.ts (파일 목록 API)
  ├── app/api/watch/route.ts (파일 감시 API)
  └── services/fileService.ts (API 서비스)
```

---

## ⚠️ 발견된 문제점들

### 1. **중복 정의로 인한 일관성 문제**
- FileNode가 3곳에 정의되어 속성 변경 시 동기화 필요
- NotificationData 중복으로 타입 불일치 위험

### 2. **타입 import 경로 혼재**
```typescript
// 현재 혼재 상황
import { FileNode } from '@/types/wiki';           // 글로벌
interface FileNode { ... }                        // 로컬 정의
```

### 3. **API 타입의 분산**
- 일부 API는 utils/apiClient.ts 사용
- 일부 API는 자체 로컬 타입 정의

### 4. **컴포넌트 Props 타입 분산**
- 각 컴포넌트마다 개별 파일에 정의
- 재사용 가능한 공통 Props 패턴 부족

---

## 🎯 중앙화 전략

### **Phase 1: 핵심 중복 타입 통합** (우선순위 1)
1. **FileNode 통합**: 3개 → 1개 (fileSystem.ts)
2. **NotificationData 통합**: 2개 → 1개 (ui.ts)

### **Phase 2: API 타입 정리** (우선순위 2)
1. API 내부 타입들을 api.ts로 이동
2. 기존 apiClient.ts 타입들과 통합

### **Phase 3: 컴포넌트 타입 정리** (우선순위 3)
1. 공통 Props 패턴 추출
2. 컴포넌트별 고유 타입 ui.ts 이동

---

## 📋 구현 계획

### **types/ 폴더 구조**
```
types/
├── index.ts          # 통합 export
├── fileSystem.ts     # 파일 시스템 관련 (FileNode, FileEntry 등)
├── api.ts           # API 관련 (기존 + 새로운 타입들)
├── ui.ts            # UI 컴포넌트 관련 (Notification, Modal 등)
└── common.ts        # 공통 기본 타입 (필요시)
```

### **타입 이동 우선순위**
1. 🔴 **즉시 처리**: FileNode, NotificationData (높은 중복도)
2. 🟡 **단계적 처리**: API 내부 타입들 (중간 복잡도)
3. 🟢 **최종 정리**: 컴포넌트 Props (낮은 우선순위)

---

## ✅ 성공 지표

### **정량적 지표**
- [ ] 중복 타입 제거: 5개 → 0개 (100% 감소)
- [ ] import 경로 통일: 15+ 파일 일관성 확보
- [ ] 타입 안전성: 컴파일 에러 0개 유지

### **정성적 지표**
- [ ] IDE 자동완성 향상
- [ ] 타입 변경 시 일관성 보장
- [ ] 새로운 컴포넌트 개발 시 재사용성 향상

---

## 🚨 리스크 요소

### **높은 리스크**
- FileNode 변경 시 3개 파일 동시 영향 (메인 페이지, 트리, 모달)
- import 경로 변경으로 인한 일시적 빌드 에러

### **중간 리스크**
- NotificationData 변경 시 Context와 Hook 동기화
- API 타입 변경 시 런타임 에러 가능성

### **완화 방안**
- 각 단계마다 TypeScript 컴파일 검증
- 점진적 이동 (한 번에 하나씩)
- Git 커밋으로 롤백 지점 확보

---

## 🔄 다음 단계

**Phase 1.1.2 중앙화된 타입 구조 설계**로 진행하여 구체적인 통합 타입 구조를 설계하겠습니다.

이 분석을 바탕으로 안전하고 체계적인 타입 중앙화를 수행할 준비가 완료되었습니다.