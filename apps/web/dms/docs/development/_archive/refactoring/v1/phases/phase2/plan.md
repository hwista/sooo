# 🔧 Phase 2: 핵심 컴포넌트 분할 - 상세 계획

## 📋 Phase 2 개요

**목표**: WikiPage 거대 컴포넌트(1,076줄)를 역할별로 분할하여 단일 책임 원칙 적용  
**기간**: 2-3일 예상  
**전제 조건**: ✅ Phase 1 완료 (타입 시스템, API 레이어, 서비스 레이어 구축)

---

## 🎯 Phase 2 목표

1. **거대 컴포넌트 분할**: WikiPage 1,076줄 → 5개 전문 컴포넌트
2. **단일 책임 원칙**: 각 컴포넌트가 하나의 명확한 역할 담당
3. **상태 관리 개선**: Context API를 통한 상태 중앙화
4. **컴포넌트 합성**: 재사용 가능한 컴포넌트 구조

---

## 📊 현재 WikiPage 분석

### 🚨 **문제점**
- **1,076줄**: 단일 파일이 너무 거대함
- **11개 useState**: 상태 관리가 복잡함
- **다중 책임**: 파일 관리, UI 제어, 에디터, 검색 등 모든 것 담당
- **Props Drilling**: 깊은 컴포넌트 계층으로 props 전달 복잡

### 📋 **담당 책임 분석**
```tsx
// WikiPage가 현재 담당하는 책임들
1. 파일 시스템 관리 (CRUD 작업)
2. 사이드바 리사이즈 로직
3. 파일 트리 상태 관리
4. 에디터 상태 및 내용 관리
5. 모달 관리 (생성, 삭제 확인)
6. 컨텍스트 메뉴 처리
7. 검색 기능
8. 실시간 파일 감시 (SSE)
9. 알림 시스템
10. 이름 변경 처리
11. 드래그 앤 드롭
```

---

## 🎯 분할 전략

### **🏗️ 목표 아키텍처**
```
WikiApp (메인 컨테이너)
├── WikiProvider (Context 상태 관리)
├── WikiSidebar (파일 트리 + 검색)
│   ├── FileTreePanel
│   └── SearchPanel  
├── WikiEditor (에디터 영역)
│   ├── EditorHeader
│   ├── EditorContent
│   └── EditorStatus
├── WikiModals (모달 관리)
│   ├── CreateFileModal
│   ├── DeleteConfirmModal
│   └── RenameModal
└── WikiNotifications (알림 시스템)
```

### **📦 분할된 컴포넌트별 책임**

#### **1. WikiApp** (메인 컨테이너)
- **책임**: 전체 레이아웃, 리사이즈 처리
- **크기**: ~150줄 예상
- **상태**: 사이드바 너비, 전체 레이아웃 상태

#### **2. WikiProvider** (Context 상태 관리)
- **책임**: 전역 상태 관리, 서비스 연동
- **크기**: ~200줄 예상
- **제공**: 파일 상태, CRUD 작업, 에러 처리

#### **3. WikiSidebar** (파일 트리 + 검색)
- **책임**: 파일 탐색, 검색, 컨텍스트 메뉴
- **크기**: ~300줄 예상
- **기능**: 트리 렌더링, 검색, 우클릭 메뉴

#### **4. WikiEditor** (에디터 영역)
- **책임**: 파일 편집, 저장, 에디터 상태
- **크기**: ~250줄 예상
- **기능**: 마크다운 에디터, 자동 저장, 상태 표시

#### **5. WikiModals** (모달 관리)
- **책임**: 모든 모달 컴포넌트 관리
- **크기**: ~200줄 예상
- **기능**: 파일 생성, 삭제 확인, 이름 변경

---

## 🚀 실행 순서 (우선순위순)

### **✅ 2.1: Context 상태 관리 구축** ⭐
- **이유**: 분할 전 상태 관리 체계 확립 필요
- **영향도**: 모든 컴포넌트에 영향
- **작업**: WikiProvider, WikiContext 구현

### **🎯 2.2: WikiSidebar 분리** ⭐⭐
- **이유**: 독립성이 높고 분리하기 용이
- **영향도**: 트리 관련 로직 집중
- **작업**: 파일 트리, 검색, 컨텍스트 메뉴 분리

### **🎯 2.3: WikiEditor 분리** ⭐⭐⭐
- **이유**: 에디터 로직이 복잡하여 신중한 접근 필요
- **영향도**: 에디터 상태 및 저장 로직
- **작업**: 에디터 컴포넌트, 자동 저장 분리

### **🎯 2.4: WikiModals 분리** ⭐
- **이유**: 상대적으로 독립적인 기능
- **영향도**: 모달 관련 상태만 영향
- **작업**: 모든 모달 컴포넌트 통합 관리

### **🎯 2.5: WikiApp 리팩토링** ⭐⭐⭐⭐
- **이유**: 최종 통합 및 레이아웃 정리
- **영향도**: 전체 컴포넌트 구조 영향
- **작업**: 메인 컨테이너, 리사이즈 로직 정리

---

## 📝 각 작업별 상세 계획

### 🔹 **2.1 Context 상태 관리 구축**
- **영향도**: ⭐⭐⭐⭐⭐ (최고) - 모든 컴포넌트가 의존
- **복잡도**: ⭐⭐⭐ (중간) - Context API 설계
- **리스크**: 🟡 중간 - 상태 의존성 관리 필요

#### **세부 작업**
1. **2.1.1** WikiContext 인터페이스 설계
2. **2.1.2** WikiProvider 컴포넌트 구현
3. **2.1.3** 기존 상태를 Context로 이전
4. **2.1.4** 서비스 레이어와 Context 연동
5. **2.1.5** 상태 구독 패턴 적용

#### **구현 목표**
```tsx
// Context 구조
interface WikiContextType {
  // 파일 상태
  files: FileNode[];
  currentFile: string | null;
  fileContent: string;
  selectedFile: string | null;
  
  // 액션
  loadFile: (path: string) => Promise<void>;
  saveFile: (path: string, content: string) => Promise<void>;
  createFile: (path: string, content: string) => Promise<void>;
  deleteFile: (path: string) => Promise<void>;
  
  // UI 상태
  isLoading: boolean;
  error: string | null;
}
```

---

### 🔹 **2.2 WikiSidebar 분리**
- **영향도**: ⭐⭐⭐ (중간) - 트리 관련 로직 집중
- **복잡도**: ⭐⭐ (낮음) - 기존 로직 이동
- **리스크**: 🟢 낮음 - 독립성이 높은 컴포넌트

#### **세부 작업**
1. **2.2.1** WikiSidebar 컴포넌트 생성
2. **2.2.2** 파일 트리 렌더링 로직 이동
3. **2.2.3** 검색 기능 분리
4. **2.2.4** 컨텍스트 메뉴 로직 이동
5. **2.2.5** Context 연동 및 테스트

#### **분리 대상 코드**
- 파일 트리 상태 및 렌더링
- 검색 기능 (필터링, 하이라이트)
- 컨텍스트 메뉴 처리
- 폴더 확장/축소 상태

---

### 🔹 **2.3 WikiEditor 분리**
- **영향도**: ⭐⭐⭐⭐ (높음) - 에디터 핵심 기능
- **복잡도**: ⭐⭐⭐⭐ (높음) - 복잡한 에디터 로직
- **리스크**: 🟡 중간 - 자동 저장 및 상태 동기화

#### **세부 작업**
1. **2.3.1** WikiEditor 컴포넌트 생성
2. **2.3.2** 에디터 상태 관리 분리
3. **2.3.3** 자동 저장 로직 이동
4. **2.3.4** 파일 로딩 및 저장 연동
5. **2.3.5** 에디터 상태 표시 구현

#### **분리 대상 코드**
- 에디터 내용 상태 (fileContent, isEditing)
- 자동 저장 로직
- 파일 로딩 및 표시
- 에디터 UI 상태 관리

---

### 🔹 **2.4 WikiModals 분리**
- **영향도**: ⭐⭐ (낮음) - 독립적 기능
- **복잡도**: ⭐ (매우 낮음) - 기존 컴포넌트 이동
- **리스크**: 🟢 낮음 - 단순 UI 컴포넌트

#### **세부 작업**
1. **2.4.1** WikiModals 컨테이너 생성
2. **2.4.2** CreateFileModal 이동
3. **2.4.3** DeleteConfirmModal 생성
4. **2.4.4** RenameModal 통합
5. **2.4.5** 모달 상태 중앙화

---

### 🔹 **2.5 WikiApp 리팩토링**
- **영향도**: ⭐⭐⭐⭐⭐ (최고) - 전체 구조 변경
- **복잡도**: ⭐⭐⭐ (중간) - 레이아웃 및 통합
- **리스크**: 🟠 높음 - 전체 구조 영향

#### **세부 작업**
1. **2.5.1** 메인 WikiApp 컴포넌트 정리
2. **2.5.2** 리사이즈 로직 분리
3. **2.5.3** 레이아웃 컴포넌트 최적화
4. **2.5.4** 분할된 컴포넌트 통합
5. **2.5.5** 전체 테스트 및 검증

---

## 📋 성공 지표

### ✅ **정량적 지표**
- [ ] WikiPage 라인 수: 1,076 → 150줄 이하 (86% 감소)
- [ ] 컴포넌트 수: 1개 → 5개 (책임 분할)
- [ ] useState 개수: 11개 → 컴포넌트당 2-3개
- [ ] 재사용 가능 컴포넌트: 3개 이상

### ✅ **정성적 지표**
- [ ] 단일 책임 원칙 준수: 각 컴포넌트가 명확한 역할
- [ ] Props Drilling 해결: Context API 활용
- [ ] 코드 가독성: 각 파일이 이해하기 쉬운 구조
- [ ] 테스트 용이성: 독립적 컴포넌트 단위 테스트 가능

### ✅ **기능 안정성**
- [ ] 모든 기존 기능 정상 동작
- [ ] 성능 저하 없음 (React.memo 적용)
- [ ] 타입 안전성 유지
- [ ] 빌드 에러 0개

---

## 🚨 위험 요소 및 대응 방안

### **🟠 높은 위험**
1. **상태 의존성 복잡도**
   - **위험**: Context 상태 관리 실패 시 전체 기능 마비
   - **대응**: 점진적 마이그레이션, 단계별 테스트

2. **컴포넌트 간 통신**
   - **위험**: 분할 후 컴포넌트 간 데이터 흐름 복잡화
   - **대응**: 명확한 인터페이스 설계, Context 활용

### **🟡 중간 위험**
1. **성능 영향**
   - **위험**: Context 리렌더링으로 성능 저하
   - **대응**: React.memo, useMemo 적용

2. **기능 손실**
   - **위험**: 분할 과정에서 기능 누락
   - **대응**: 체크리스트 기반 검증

### **🟢 낮은 위험**
1. **타입 호환성**
   - **위험**: 기존 타입 시스템과 충돌
   - **대응**: Phase 1에서 구축한 타입 시스템 활용

---

## 📅 예상 일정

### **Day 1: Context 구축 및 Sidebar 분리**
- Context API 설계 및 구현
- WikiSidebar 분리 작업

### **Day 2: Editor 및 Modals 분리**
- WikiEditor 컴포넌트 분리
- WikiModals 통합

### **Day 3: 최종 통합 및 테스트**
- WikiApp 리팩토링
- 전체 테스트 및 검증
- 문서 업데이트

---

## ✅ Phase 2 시작 조건

### **전제 조건 확인**
- ✅ Phase 1 완료 (타입 시스템, 서비스 레이어)
- ✅ 서버 정상 동작 확인
- ✅ 기존 기능 안정성 확인
- ✅ Git 상태 정리 완료

### **준비 사항**
- [ ] Phase 2 브랜치 생성
- [ ] 백업 커밋 생성
- [ ] 개발 환경 점검

---

## 🎯 Phase 2 완료 후 기대 효과

### **개발자 경험 향상**
- 각 컴포넌트의 역할이 명확해져 개발 효율성 증대
- 독립적 컴포넌트로 병렬 개발 가능
- 단위 테스트 작성 용이

### **유지보수성 개선**
- 버그 수정 시 영향 범위 제한
- 새 기능 추가 시 특정 컴포넌트만 수정
- 코드 리뷰 품질 향상

### **확장성 확보**
- 컴포넌트 재사용으로 새 페이지 개발 가속
- 플러그인 형태로 기능 확장 가능
- 마이크로 프론트엔드 전환 기반 마련

**Phase 2 목표**: "1,076줄 거대 컴포넌트 → 5개 전문 컴포넌트"로 혁신적 구조 개선!