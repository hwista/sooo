# í…Œì´ë¸” ì •ì˜ì„œ: cm_menu (ë©”ë‰´)

## 1. ê°œìš”

| í•­ëª© | ê°’ |
|------|-----|
| í…Œì´ë¸”ëª… | `cm_menu_m` (ë§ˆìŠ¤í„°), `cm_menu_h` (íˆìŠ¤í† ë¦¬) |
| ì„¤ëª… | ì‹œìŠ¤í…œ ë©”ë‰´ ì •ì˜. íŠ¸ë¦¬ êµ¬ì¡°ë¡œ ë¶€ëª¨-ìì‹ ê´€ê³„ í‘œí˜„ |
| PK | `menu_id` (BIGSERIAL) |
| ì£¼ìš” UK | `menu_code` |

---

## 2. ì»¬ëŸ¼ ì •ì˜

| # | ì»¬ëŸ¼ëª… | íƒ€ì… | NULL | ê¸°ë³¸ê°’ | ì„¤ëª… |
|---|--------|------|------|--------|------|
| 1 | `menu_id` | BIGSERIAL | NO | auto | PK |
| 2 | `menu_code` | VARCHAR(50) | NO | - | ë©”ë‰´ ê³ ìœ  ì½”ë“œ (UK). ì˜ˆ: `dashboard`, `project.list` |
| 3 | `menu_name` | VARCHAR(100) | NO | - | ë©”ë‰´ í‘œì‹œëª… (í•œê¸€) |
| 4 | `menu_name_en` | VARCHAR(100) | YES | - | ë©”ë‰´ í‘œì‹œëª… (ì˜ë¬¸) |
| 5 | `menu_type` | VARCHAR(20) | NO | `menu` | ë©”ë‰´ ìœ í˜•: `group`, `menu`, `action` |
| 6 | `parent_menu_id` | BIGINT | YES | - | ë¶€ëª¨ ë©”ë‰´ ID (self-relation) |
| 7 | `menu_path` | VARCHAR(200) | YES | - | ë¼ìš°íŠ¸ ê²½ë¡œ. ì˜ˆ: `/project`, `/project/[id]` |
| 8 | `icon` | VARCHAR(50) | YES | - | ì•„ì´ì½˜ ì´ë¦„ (lucide-react) |
| 9 | `sort_order` | INT | NO | 0 | ë™ì¼ ë ˆë²¨ ë‚´ ì •ë ¬ ìˆœì„œ |
| 10 | `menu_level` | INT | NO | 1 | ë©”ë‰´ ê¹Šì´ (1=ìµœìƒìœ„) |
| 11 | `is_visible` | BOOLEAN | NO | true | ì‚¬ì´ë“œë°”ì— í‘œì‹œ ì—¬ë¶€ |
| 12 | `is_enabled` | BOOLEAN | NO | true | ë©”ë‰´ í™œì„±í™” ì—¬ë¶€ |
| 13 | `is_admin_menu` | BOOLEAN | NO | false | **ê´€ë¦¬ì ì „ìš© ë©”ë‰´ ì—¬ë¶€** |
| 14 | `open_type` | VARCHAR(20) | NO | `tab` | ì—´ê¸° ë°©ì‹: `tab`, `modal`, `external` |
| 15 | `description` | TEXT | YES | - | ë©”ë‰´ ì„¤ëª… |
| - | *ê³µí†µ ì»¬ëŸ¼* | - | - | - | is_active, memo, created_by, created_at, ... |

---

## 3. ë©”ë‰´ íƒ€ì… (menu_type)

| ì½”ë“œ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| `group` | ê·¸ë£¹ (í´ë¦­ ë¶ˆê°€, í•˜ìœ„ ë©”ë‰´ í¬í•¨) | "í”„ë¡œì íŠ¸", "ê´€ë¦¬ì" |
| `menu` | ë©”ë‰´ (í´ë¦­ ì‹œ íƒ­ìœ¼ë¡œ ì—´ë¦¼) | "í”„ë¡œì íŠ¸ ëª©ë¡", "ëŒ€ì‹œë³´ë“œ" |
| `action` | ì•¡ì…˜ (ê¶Œí•œ ì²´í¬ìš©, UI ë¹„í‘œì‹œ) | "í”„ë¡œì íŠ¸ ìƒì„±", "ì‚¬ìš©ì ì‚­ì œ" |

---

## 4. ì—´ê¸° ë°©ì‹ (open_type)

| ì½”ë“œ | ì„¤ëª… |
|------|------|
| `tab` | MDI íƒ­ìœ¼ë¡œ ì—´ê¸° (ê¸°ë³¸) |
| `modal` | ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸ë¡œ ì—´ê¸° |
| `external` | ìƒˆ ì°½/íƒ­ìœ¼ë¡œ ì—´ê¸° |

---

## 5. ì‚¬ì´ë“œë°” UI êµ¬ì¡°

### 5.1 ì‚¬ì´ë“œë°” ë ˆì´ì•„ì›ƒ

ì‚¬ì´ë“œë°”ëŠ” 4ê°œì˜ ë…ë¦½ì ì¸ ì„¹ì…˜ìœ¼ë¡œ êµ¬ì„±ë˜ë©°, **ê´€ë¦¬ì ë©”ë‰´ëŠ” ì „ì²´ë©”ë‰´ì˜ í•˜ìœ„ê°€ ì•„ë‹Œ ë™ì¼ ë ˆë²¨ë¡œ ë¶„ë¦¬**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â­ ì¦ê²¨ì°¾ê¸°                          â”‚ â† ì‚¬ìš©ìë³„ ì¦ê²¨ì°¾ê¸° ë©”ë‰´
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“„ í˜„ì¬ ì—´ë¦° í˜ì´ì§€                   â”‚ â† MDI íƒ­ìœ¼ë¡œ ì—´ë¦° í˜ì´ì§€ ëª©ë¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ ì „ì²´ë©”ë‰´                          â”‚ â† is_admin_menu = false ë©”ë‰´
â”‚    â”œâ”€â”€ ëŒ€ì‹œë³´ë“œ                       â”‚
â”‚    â”œâ”€â”€ ìš”ì²­                           â”‚
â”‚    â”œâ”€â”€ ì œì•ˆ                           â”‚
â”‚    â”œâ”€â”€ ì‹¤í–‰                           â”‚
â”‚    â””â”€â”€ ì „í™˜                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”’ ê´€ë¦¬ì (is_admin ì „ìš©)            â”‚ â† is_admin_menu = true ë©”ë‰´
â”‚    â”œâ”€â”€ ì‚¬ìš©ì ê´€ë¦¬                    â”‚   (cm_user_m.is_admin = trueì¸
â”‚    â”œâ”€â”€ ì—­í•  ê´€ë¦¬                      â”‚    ì‚¬ìš©ìì—ê²Œë§Œ í‘œì‹œ)
â”‚    â”œâ”€â”€ ë©”ë‰´ ê´€ë¦¬                      â”‚
â”‚    â”œâ”€â”€ ì½”ë“œ ê´€ë¦¬                      â”‚
â”‚    â”œâ”€â”€ ê³ ê°ì‚¬ ê´€ë¦¬                    â”‚
â”‚    â””â”€â”€ ë¶€ì„œ ê´€ë¦¬                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ì¼ë°˜ ì‚¬ìš©ì ë©”ë‰´ (is_admin_menu = false)
í”„ë¡œì íŠ¸ ìƒíƒœ ê¸°ë°˜ ë©”ë‰´ êµ¬ì¡°:

```
dashboard (ëŒ€ì‹œë³´ë“œ)
â”œâ”€â”€ menu_level: 1, sort_order: 1

request (ìš”ì²­)
â”œâ”€â”€ menu_level: 1, sort_order: 2, menu_type: group
â”œâ”€â”€ request.list (ìš”ì²­ ëª©ë¡)
â”‚   â””â”€â”€ menu_level: 2, sort_order: 1

proposal (ì œì•ˆ)
â”œâ”€â”€ menu_level: 1, sort_order: 3, menu_type: group
â”œâ”€â”€ proposal.list (ì œì•ˆ ëª©ë¡)
â”‚   â””â”€â”€ menu_level: 2, sort_order: 1

execution (ì‹¤í–‰)
â”œâ”€â”€ menu_level: 1, sort_order: 4, menu_type: group
â”œâ”€â”€ execution.list (ì‹¤í–‰ í”„ë¡œì íŠ¸ ëª©ë¡)
â”‚   â””â”€â”€ menu_level: 2, sort_order: 1

transition (ì „í™˜)
â”œâ”€â”€ menu_level: 1, sort_order: 5, menu_type: group
â”œâ”€â”€ transition.list (ì „í™˜ ëª©ë¡)
â”‚   â””â”€â”€ menu_level: 2, sort_order: 1
```

### 5.3 ê´€ë¦¬ì ë©”ë‰´ (is_admin_menu = true)
ê´€ë¦¬ì ì „ìš© ë©”ë‰´ (cm_user_m.is_admin = true ì¸ ì‚¬ìš©ìë§Œ ì ‘ê·¼):

```
admin (ê´€ë¦¬ì)
â”œâ”€â”€ menu_level: 1, sort_order: 1, is_admin_menu: true
â”œâ”€â”€ admin.user (ì‚¬ìš©ì ê´€ë¦¬)
â”‚   â””â”€â”€ menu_level: 2, sort_order: 1, is_admin_menu: true
â”œâ”€â”€ admin.role (ì—­í•  ê´€ë¦¬)
â”‚   â””â”€â”€ menu_level: 2, sort_order: 2, is_admin_menu: true
â”œâ”€â”€ admin.menu (ë©”ë‰´ ê´€ë¦¬)
â”‚   â””â”€â”€ menu_level: 2, sort_order: 3, is_admin_menu: true
â”œâ”€â”€ admin.code (ì½”ë“œ ê´€ë¦¬)
â”‚   â””â”€â”€ menu_level: 2, sort_order: 4, is_admin_menu: true
â”œâ”€â”€ admin.customer (ê³ ê°ì‚¬ ê´€ë¦¬)
â”‚   â””â”€â”€ menu_level: 2, sort_order: 5, is_admin_menu: true
â”œâ”€â”€ admin.dept (ë¶€ì„œ ê´€ë¦¬)
â”‚   â””â”€â”€ menu_level: 2, sort_order: 6, is_admin_menu: true
```

### 5.4 ë©”ë‰´ ê¶Œí•œ ê·œì¹™
| ì‚¬ìš©ì ìœ í˜• | is_admin | ì „ì²´ë©”ë‰´ | ê´€ë¦¬ì ì„¹ì…˜ |
|------------|----------|---------|------------|
| ì¼ë°˜ ì‚¬ìš©ì | false | âœ… í‘œì‹œ | âŒ ìˆ¨ê¹€ |
| ê´€ë¦¬ì | true | âœ… í‘œì‹œ | âœ… í‘œì‹œ |

**í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ ê°€ì´ë“œ:**
```typescript
// ë©”ë‰´ ì¡°íšŒ API ì‘ë‹µ êµ¬ì¡°
interface MenuResponse {
  generalMenus: Menu[];   // is_admin_menu = false (ì „ì²´ë©”ë‰´ ì„¹ì…˜)
  adminMenus: Menu[];     // is_admin_menu = true (ê´€ë¦¬ì ì„¹ì…˜, is_admin=trueë§Œ)
}

// ì‚¬ì´ë“œë°” ë Œë”ë§ ë¡œì§
const Sidebar = ({ user, menus }: Props) => (
  <>
    <FavoriteSection />
    <OpenPagesSection />
    <GeneralMenuSection menus={menus.generalMenus} />
    {user.isAdmin && <AdminMenuSection menus={menus.adminMenus} />}
  </>
);
```

---

## 6. ì¸ë±ìŠ¤

| ì¸ë±ìŠ¤ëª… | ì»¬ëŸ¼ | ìš©ë„ |
|----------|------|------|
| `ux_cm_menu_m_code` | `menu_code` | UK: ë©”ë‰´ ì½”ë“œ ìœ ì¼ì„± |
| `ix_cm_menu_m_parent` | `parent_menu_id` | ë¶€ëª¨ ë©”ë‰´ ì¡°íšŒ |
| `ix_cm_menu_m_level_order` | `menu_level`, `sort_order` | ë©”ë‰´ íŠ¸ë¦¬ ì •ë ¬ |
| `ix_cm_menu_m_active` | `is_active` | í™œì„± ë©”ë‰´ í•„í„° |

---

## 7. ê´€ë ¨ í…Œì´ë¸”

- `cm_role_menu_r`: ì—­í• ë³„ ë©”ë‰´ ê¶Œí•œ
- `cm_user_menu_r`: ì‚¬ìš©ìë³„ ë©”ë‰´ ê¶Œí•œ (ì˜ˆì™¸)
- `cm_dept_menu_r`: ë¶€ì„œë³„ ë©”ë‰´ ê¶Œí•œ (í™•ì¥ìš©)

---

## 8. API

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/api/auth/my-menus` | ë¡œê·¸ì¸ ì‚¬ìš©ìì˜ ë©”ë‰´ íŠ¸ë¦¬ ì¡°íšŒ |
| GET | `/api/admin/menus` | ì „ì²´ ë©”ë‰´ ëª©ë¡ (ê´€ë¦¬ì) |
| POST | `/api/admin/menus` | ë©”ë‰´ ìƒì„± |
| PUT | `/api/admin/menus/:id` | ë©”ë‰´ ìˆ˜ì • |
| DELETE | `/api/admin/menus/:id` | ë©”ë‰´ ì‚­ì œ |
